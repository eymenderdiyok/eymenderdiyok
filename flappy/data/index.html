<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Bird - HTML5</title>
  <style>
    :root {
      --bg-1: #0b132b;
      --bg-2: #1c2541;
      --bg-3: #5bc0be;
      --ink: #f6f7fb;
      --accent: #fbc531;
      --pipe: #2ecc71;
      --pipe-dark: #27ae60;
      --danger: #ff6b6b;
      --shadow: rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      font-family: "Bebas Neue", "Oswald", "Trebuchet MS", sans-serif;
      color: var(--ink);
      background: #000;
      overflow: hidden;
    }

    .wrap {
      height: 100%;
      width: 100%;
    }

    .game-shell {
      width: 100vw;
      height: 100vh;
      background: linear-gradient(180deg, #2c3e50 0%, #0f2027 70%, #0b132b 100%);
      position: relative;
      overflow: hidden;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .score {
      position: absolute;
      top: 18px;
      left: 18px;
      font-size: clamp(24px, 4vw, 44px);
      letter-spacing: 1px;
      text-shadow: 0 6px 18px rgba(0,0,0,0.4);
    }

    .best {
      position: absolute;
      top: 18px;
      right: 18px;
      font-size: clamp(14px, 2.2vw, 22px);
      opacity: 0.85;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .center-panel {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 24px;
      pointer-events: none;
    }

    .panel-card {
      background: rgba(12, 18, 36, 0.85);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 20px 28px;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
      max-width: 420px;
      pointer-events: auto; /* Butonların tıklanması için şart */
    }

    .panel-title {
      font-size: clamp(22px, 3.2vw, 36px);
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .panel-sub {
      font-family: "Trebuchet MS", sans-serif;
      font-size: clamp(14px, 1.8vw, 18px);
      opacity: 0.9;
    }

    .btn-row {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    button {
      border: none;
      background: linear-gradient(135deg, #fbc531, #e1b12c);
      color: #1b1b1b;
      font-weight: 700;
      padding: 10px 18px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 10px 18px rgba(251,197,49,0.35);
      transition: transform 0.2s ease;
    }

    button:hover { transform: translateY(-2px); }

    .footer {
      position: absolute;
      bottom: 14px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      font-size: 12px;
      opacity: 0.7;
    }

    .flash {
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.08);
      opacity: 0;
      pointer-events: none;
    }

    .flash.on { opacity: 1; transition: opacity 0.2s; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game-shell">
      <canvas id="game"></canvas>
      <div class="hud">
        <div class="score" id="score">0</div>
        <div class="best" id="best">En iyi: 0</div>
        <div class="center-panel" id="overlay">
          <div class="panel-card">
            <div class="panel-title">FLAPPY BIRD</div>
            <div class="panel-sub">Engellerin arasından uç ve rekor kır.</div>
            <div class="btn-row">
              <button id="startBtn">Başla</button>
              <button id="muteBtn">Ses: Açık</button>
            </div>
          </div>
        </div>
        <div class="footer">R tuşu: restart</div>
      </div>
      <div class="flash" id="flash"></div>
    </div>
  </div>

  <script>
    "use strict";

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const bestEl = document.getElementById("best");
    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");
    const muteBtn = document.getElementById("muteBtn");
    const flash = document.getElementById("flash");

    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

    const state = {
      width: window.innerWidth,
      height: window.innerHeight,
      running: false,
      gameOver: false,
      score: 0,
      best: Number(localStorage.getItem("flappy-best") || 0),
      muted: false,
      lastTime: 0,
      shake: 0,
      speed: 220,
      gravity: 1300,
      lift: -420,
    };

    const bird = { x: 0, y: 0, r: 16, vy: 0, rot: 0 };
    const pipes = [];
    const pipeCfg = { gap: 170, width: 70, spacing: 260, minTop: 80 };

    let clouds = Array.from({ length: 10 }, (_, i) => ({
      x: Math.random() * window.innerWidth,
      y: 60 + (i % 5) * 60,
      speed: 10 + i * 2,
      size: 26 + i * 3,
    }));

    let stars = Array.from({ length: 80 }, () => ({
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight * 0.7,
      r: Math.random() * 1.7 + 0.3,
      tw: Math.random() * 1.5 + 0.5,
    }));

    function resize() {
      state.width = window.innerWidth;
      state.height = window.innerHeight;
      canvas.width = state.width * DPR;
      canvas.height = state.height * DPR;
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      reset();
    }

    function reset() {
      bird.x = state.width * 0.28;
      bird.y = state.height * 0.45;
      bird.vy = 0;
      bird.rot = 0;
      pipes.length = 0;
      state.score = 0;
      state.speed = 220;
      pushPipe(state.width + 200);
      pushPipe(state.width + 200 + pipeCfg.spacing);
      updateScore();
    }

    function pushPipe(x) {
      const top = pipeCfg.minTop + Math.random() * (state.height - pipeCfg.gap - pipeCfg.minTop * 2 - 100);
      pipes.push({ x, top, passed: false });
    }

    function updateScore() {
      scoreEl.textContent = state.score;
      bestEl.textContent = `En iyi: ${state.best}`;
    }

    function startGame() {
      overlay.style.display = "none";
      state.gameOver = false;
      state.running = true;
      state.lastTime = performance.now();
      reset();
      requestAnimationFrame(loop);
    }

    function endGame() {
      state.gameOver = true;
      state.running = false;
      flash.classList.add("on");
      setTimeout(() => flash.classList.remove("on"), 180);
      overlay.style.display = "grid";
      overlay.querySelector(".panel-title").textContent = "OYUN BİTTİ";
      state.best = Math.max(state.best, state.score);
      localStorage.setItem("flappy-best", state.best);
      updateScore();
    }

    function jump() {
      if (state.running) {
        bird.vy = state.lift;
        playBeep(440, 0.08, 0.07);
      }
    }

    function update(dt) {
      if (!state.running) return;

      bird.vy += state.gravity * dt;
      bird.y += bird.vy * dt;
      bird.rot = Math.min(Math.max(bird.vy / 600, -0.6), 1.2);
      state.speed += dt * 5;

      for (const pipe of pipes) {
        pipe.x -= state.speed * dt;
        if (!pipe.passed && pipe.x + pipeCfg.width < bird.x) {
          pipe.passed = true;
          state.score += 1;
          updateScore();
          playBeep(660, 0.08, 0.05);
        }
      }

      if (pipes[0].x + pipeCfg.width < -50) {
        pipes.shift();
        pushPipe(pipes[pipes.length - 1].x + pipeCfg.spacing);
      }

      if (bird.y < 0 || bird.y > state.height) endGame();

      for (const pipe of pipes) {
        const bx = bird.x, by = bird.y, r = bird.r;
        if (bx + r > pipe.x && bx - r < pipe.x + pipeCfg.width) {
          if (by - r < pipe.top || by + r > pipe.top + pipeCfg.gap) {
            endGame();
            state.shake = 10;
          }
        }
      }

      clouds.forEach(c => {
        c.x -= c.speed * dt;
        if (c.x + 100 < 0) c.x = state.width + 100;
      });
      stars.forEach(s => s.tw += dt * 3);
    }

    function render() {
      ctx.save();
      if (state.shake > 0) {
        ctx.translate((Math.random()-0.5)*state.shake, (Math.random()-0.5)*state.shake);
        state.shake--;
      }
      
      // Background
      const grd = ctx.createLinearGradient(0, 0, 0, state.height);
      grd.addColorStop(0, "#1b2845"); grd.addColorStop(1, "#090a12");
      ctx.fillStyle = grd; ctx.fillRect(0,0,state.width,state.height);

      // Stars & Clouds
      ctx.fillStyle = "white";
      stars.forEach(s => {
        ctx.globalAlpha = 0.5 + 0.5 * Math.sin(s.tw);
        ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
      });
      ctx.globalAlpha = 0.12;
      clouds.forEach(c => {
        ctx.beginPath(); ctx.ellipse(c.x, c.y, c.size*2, c.size, 0, 0, Math.PI*2); ctx.fill();
      });
      ctx.globalAlpha = 1;

      // Pipes
      pipes.forEach(p => {
        ctx.fillStyle = "#2ecc71";
        ctx.fillRect(p.x, 0, pipeCfg.width, p.top);
        ctx.fillRect(p.x, p.top + pipeCfg.gap, pipeCfg.width, state.height);
      });

      // Bird
      ctx.save();
      ctx.translate(bird.x, bird.y); ctx.rotate(bird.rot);
      ctx.fillStyle = "#fbc531"; ctx.beginPath(); ctx.arc(0,0,bird.r,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(6,-3,3,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = "#e17055"; ctx.beginPath(); ctx.moveTo(10,0); ctx.lineTo(20,5); ctx.lineTo(10,10); ctx.fill();
      ctx.restore();

      // Ground
      ctx.fillStyle = "#0f2027"; ctx.fillRect(0, state.height-50, state.width, 50);
      ctx.restore();
    }

    function loop(time) {
      const dt = Math.min(0.02, (time - state.lastTime) / 1000);
      state.lastTime = time;
      update(dt);
      render();
      if (state.running) requestAnimationFrame(loop);
    }

    let audioCtx;
    function playBeep(f, d, v) {
      if (state.muted) return;
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.frequency.value = f; g.gain.value = v;
      o.connect(g); g.connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + d);
    }

    startBtn.addEventListener("click", (e) => { e.stopPropagation(); startGame(); });
    muteBtn.addEventListener("click", (e) => { 
      e.stopPropagation(); 
      state.muted = !state.muted;
      muteBtn.textContent = `Ses: ${state.muted ? "Kapalı" : "Açık"}`;
    });
    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") { e.preventDefault(); jump(); }
      if (e.code === "KeyR") startGame();
    });
    window.addEventListener("pointerdown", (e) => { if(state.running) jump(); });
    window.addEventListener("resize", resize);

    resize();
    render();
  </script>
</body>
</html>
