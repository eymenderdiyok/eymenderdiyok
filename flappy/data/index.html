<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Bird</title>
  <style>
    :root {
      --bg-1: #0b132b;
      --ink: #f6f7fb;
      --accent: #fbc531;
    }

    /* Sayfadaki tüm boşlukları sıfırla */
    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden; /* Kaydırma çubuklarını yok et */
      background-color: #000;
      font-family: "Trebuchet MS", sans-serif;
    }

    /* Oyun alanını tarayıcı penceresine kilitle */
    .game-shell {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
      display: block;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
      color: var(--ink);
    }

    .score {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: clamp(24px, 6vw, 48px);
      font-weight: bold;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
    }

    .best {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: clamp(14px, 3vw, 20px);
      opacity: 0.9;
    }

    .center-panel {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0, 0, 0, 0.4); /* Arka planı hafif karart ki oyun arkada görünsün */
      pointer-events: auto;
    }

    .panel-card {
      background: #1c2541;
      padding: 30px 50px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border: 2px solid var(--accent);
    }

    button {
      background: var(--accent);
      border: none;
      padding: 15px 40px;
      font-size: 20px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.1s;
    }

    button:active { transform: scale(0.95); }

    .flash {
      position: absolute;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
    }

    .flash.on { opacity: 0.4; transition: opacity 0.1s; }
  </style>
</head>
<body>

  <div class="game-shell">
    <canvas id="game"></canvas>
    
    <div class="hud">
      <div class="score" id="score">0</div>
      <div class="best" id="best">En iyi: 0</div>
      
      <div class="center-panel" id="overlay">
        <div class="panel-card">
          <h1 style="color:var(--accent); margin:0 0 10px 0;">FLAPPY BIRD</h1>
          <p style="color:white; margin:0;">Zıplamak için Tıkla / Boşluk</p>
          <button id="startBtn">BAŞLA</button>
        </div>
      </div>
    </div>
    
    <div class="flash" id="flash"></div>
  </div>

  <script>
    "use strict";

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const bestEl = document.getElementById("best");
    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");
    const flash = document.getElementById("flash");

    const state = {
      width: 0,
      height: 0,
      running: false,
      gameOver: false,
      score: 0,
      best: Number(localStorage.getItem("fb-best") || 0),
      lastTime: 0,
      speed: 250,
      gravity: 1200,
      lift: -380
    };

    const bird = { x: 0, y: 0, r: 18, vy: 0, rot: 0 };
    const pipes = [];
    const pipeCfg = { gap: 190, width: 80, spacing: 320 };

    // Ekran boyutunu her zaman pencereye göre güncelle
    function resize() {
      state.width = window.innerWidth;
      state.height = window.innerHeight;
      
      const dpr = window.devicePixelRatio || 1;
      canvas.width = state.width * dpr;
      canvas.height = state.height * dpr;
      ctx.scale(dpr, dpr);
      
      if (!state.running) reset();
    }

    function reset() {
      bird.x = state.width * 0.25;
      bird.y = state.height / 2;
      bird.vy = 0;
      pipes.length = 0;
      state.score = 0;
      state.speed = 250;
      state.gameOver = false;
      
      // İlk boruları ekle
      pushPipe(state.width + 200);
      pushPipe(state.width + 200 + pipeCfg.spacing);
      updateScore();
    }

    function pushPipe(x) {
      const margin = 100;
      const range = state.height - pipeCfg.gap - margin * 2;
      const top = margin + Math.random() * range;
      pipes.push({ x, top, passed: false });
    }

    function updateScore() {
      scoreEl.textContent = state.score;
      bestEl.textContent = `En iyi: ${state.best}`;
    }

    function startGame() {
      overlay.style.display = "none";
      state.running = true;
      state.gameOver = false;
      state.lastTime = performance.now();
      reset();
      requestAnimationFrame(loop);
    }

    function endGame() {
      state.running = false;
      state.gameOver = true;
      flash.classList.add("on");
      setTimeout(() => flash.classList.remove("on"), 150);
      
      overlay.style.display = "grid";
      overlay.querySelector("h1").textContent = "OYUN BİTTİ";
      state.best = Math.max(state.best, state.score);
      localStorage.setItem("fb-best", state.best);
      updateScore();
    }

    function jump() {
      if (state.running) bird.vy = state.lift;
      else if (state.gameOver || overlay.style.display !== "none") {
          // Eğer oyun bittiyse veya başlangıç ekranındaysak butona basılmasını bekler (veya buraya startGame ekleyebilirsin)
      }
    }

    function update(dt) {
      if (!state.running) return;

      bird.vy += state.gravity * dt;
      bird.y += bird.vy * dt;
      bird.rot = Math.min(Math.max(bird.vy / 500, -0.5), 1);

      for (let i = pipes.length - 1; i >= 0; i--) {
        const p = pipes[i];
        p.x -= state.speed * dt;

        if (!p.passed && p.x + pipeCfg.width < bird.x) {
          p.passed = true;
          state.score++;
          updateScore();
          state.speed += 3; // Zorluk artışı
        }

        if (p.x + pipeCfg.width < -100) {
          pipes.splice(i, 1);
          pushPipe(pipes[pipes.length - 1].x + pipeCfg.spacing);
        }

        // Çarpışma kontrolü
        if (bird.x + bird.r > p.x && bird.x - bird.r < p.x + pipeCfg.width) {
          if (bird.y - bird.r < p.top || bird.y + bird.r > p.top + pipeCfg.gap) {
            endGame();
          }
        }
      }

      if (bird.y + bird.r > state.height || bird.y - bird.r < 0) endGame();
    }

    function render() {
      // Arka Plan
      const grd = ctx.createLinearGradient(0, 0, 0, state.height);
      grd.addColorStop(0, "#2c3e50");
      grd.addColorStop(1, "#000000");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, state.width, state.height);

      // Borular
      pipes.forEach(p => {
        ctx.fillStyle = "#2ecc71";
        // Üst boru
        ctx.fillRect(p.x, 0, pipeCfg.width, p.top);
        // Alt boru
        ctx.fillRect(p.x, p.top + pipeCfg.gap, pipeCfg.width, state.height);
        // Boru başlıkları
        ctx.fillStyle = "#27ae60";
        ctx.fillRect(p.x - 5, p.top - 20, pipeCfg.width + 10, 20);
        ctx.fillRect(p.x - 5, p.top + pipeCfg.gap, pipeCfg.width + 10, 20);
      });

      // Kuş
      ctx.save();
      ctx.translate(bird.x, bird.y);
      ctx.rotate(bird.rot);
      ctx.fillStyle = "#fbc531";
      ctx.beginPath();
      ctx.arc(0, 0, bird.r, 0, Math.PI * 2);
      ctx.fill();
      // Göz
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(8, -5, 3, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    function loop(time) {
      const dt = (time - state.lastTime) / 1000;
      state.lastTime = time;
      update(Math.min(dt, 0.1));
      render();
      if (state.running) requestAnimationFrame(loop);
    }

    window.addEventListener("resize", resize);
    window.addEventListener("keydown", e => { if(e.code === "Space") jump(); });
    window.addEventListener("pointerdown", e => { 
        if(state.running) jump(); 
    });

    startBtn.addEventListener("click", (e) => {
        e.stopPropagation(); // Tıklamanın hemen zıplatmasını engelle
        startGame();
    });

    // Başlangıçta ekranı ayarla ve çiz
    resize();
    render();
  </script>
</body>
</html>
