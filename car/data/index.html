<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Modern Car Driver 3D | Real Edition</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* UI ELEMENTS */
        .overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); z-index: 100; color: white; }
        .hidden { display: none !important; }
        
        .menu-card { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 40px; border: 1px solid rgba(255,255,255,0.1); text-align: center; width: 450px; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        input { background: rgba(255,255,255,0.1); border: 2px solid #0071e3; color: white; padding: 15px; border-radius: 15px; width: 80%; outline: none; font-size: 1.2rem; margin-bottom: 25px; text-align: center; }
        
        .mode-selector { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
        .mode-btn { padding: 12px 25px; border: 2px solid #333; border-radius: 15px; color: #888; cursor: pointer; background: transparent; transition: 0.3s; font-weight: bold; }
        .mode-btn.active { border-color: #0071e3; color: white; background: #0071e3; box-shadow: 0 0 20px rgba(0,113,227,0.4); }

        .start-btn { background: #32d74b; color: white; border: none; padding: 20px; border-radius: 20px; font-size: 1.6rem; font-weight: 800; cursor: pointer; width: 100%; transition: 0.2s; }
        .start-btn:hover { transform: scale(1.02); background: #3cf259; }
        
        #hud { position: absolute; top: 0; left: 0; width: 100%; padding: 30px; display: flex; justify-content: space-between; color: white; font-size: 1.8rem; pointer-events: none; z-index: 50; font-weight: 900; }
        .speed-box { position: absolute; bottom: 40px; right: 40px; text-align: right; }
        .speed-val { font-size: 4rem; color: #0071e3; line-height: 1; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="menu" class="overlay">
        <div class="menu-card">
            <h1 style="font-size: 2.5rem; margin-bottom: 10px;">MODERN DRIVER</h1>
            <p style="color: #888; margin-bottom: 30px;">GerÃ§ekÃ§i 3D YarÄ±ÅŸ SimÃ¼lasyonu</p>
            <input type="text" id="playerName" placeholder="Pilot Ä°smi" maxlength="10">
            <div class="mode-selector">
                <button class="mode-btn" onclick="setMode(0.7, this)">KOLAY</button>
                <button class="mode-btn active" onclick="setMode(1, this)">NORMAL</button>
                <button class="mode-btn" onclick="setMode(1.4, this)">ZOR</button>
            </div>
            <button class="start-btn" onclick="init()">BAÅžLAT</button>
        </div>
    </div>

    <div id="results" class="overlay hidden">
        <div class="menu-card">
            <div id="medal-icon" style="font-size: 6rem; margin-bottom: 20px;">ðŸ¥‡</div>
            <h2 id="rank-text" style="font-size: 3rem; margin: 0;">1. OLDUN!</h2>
            <p id="time-text" style="color: #888; margin-bottom: 30px;">Harika bir sÃ¼rÃ¼ÅŸ!</p>
            <button class="start-btn" onclick="location.reload()">TEKRAR YARIÅž</button>
        </div>
    </div>

    <div id="hud" class="hidden">
        <div id="pos-ui">SIRA: 1/8</div>
        <div class="speed-box">
            <div id="speed-ui" class="speed-val">0</div>
            <div style="font-size: 1rem; color: #888;">KM/H</div>
        </div>
    </div>

<script>
/**
 * 3D ENGINE - REAL CARS & PHYSICS
 */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let player, segments = [], cars = [], running = false, difficulty = 1;
let keys = {};
let trackLength = 0;

const CFG = {
    roadW: 2000, segL: 200, camH: 1000, camD: 0.84, drawD: 300,
    maxS: 26000, accel: 8500, brake: -12000, decel: -5000
};

window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

function setMode(m, btn) {
    difficulty = m;
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function init() {
    const name = document.getElementById('playerName').value || "PÄ°LOT";
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    player = { x: 0, z: 0, speed: 0, lap: 1 };
    segments = [];

    // PÄ°ST OLUÅžTURMA
    for(let i=0; i<1500; i++) {
        segments.push({
            index: i,
            p1: { world: { z: i*CFG.segL }, screen: {} },
            p2: { world: { z: (i+1)*CFG.segL }, screen: {} },
            curve: i > 200 && i < 400 ? 3 : i > 700 && i < 900 ? -4 : i > 1100 ? 2 : 0,
            color: Math.floor(i/3)%2 ? '#333' : '#383838'
        });
    }
    trackLength = segments.length * CFG.segL;

    // RAKÄ°P GERÃ‡EKÃ‡Ä° ARABALAR
    cars = [];
    for(let i=0; i<7; i++) {
        cars.push({
            x: (Math.random() * 1.4 - 0.7),
            z: (i + 1) * (trackLength / 8),
            speed: (13000 + Math.random() * 5000) * difficulty,
            color: `hsl(${Math.random() * 360}, 70%, 50%)`
        });
    }

    running = true;
    requestAnimationFrame(loop);
}

function project(p, camX, camY, camZ) {
    p.camera = { x: (p.world.x||0) - camX, y: (p.world.y||0) - camY, z: p.world.z - camZ };
    p.screen.scale = CFG.camD / p.camera.z;
    p.screen.x = (canvas.width/2) + (p.screen.scale * p.camera.x * canvas.width/2);
    p.screen.y = (canvas.height/2) - (p.screen.scale * p.camera.y * canvas.height/2);
    p.screen.w = (p.screen.scale * CFG.roadW * canvas.width/2);
}

function loop(time) {
    if(!running) return;
    update(1/60);
    render();
    requestAnimationFrame(loop);
}

function update(dt) {
    if(keys['ArrowUp'] || keys['KeyW']) player.speed += CFG.accel * dt;
    else if(keys['ArrowDown'] || keys['KeyS']) player.speed += CFG.brake * dt;
    else player.speed += CFG.decel * dt;

    if(keys['ArrowLeft'] || keys['KeyA']) player.x = Math.max(-0.85, player.x - 1.5 * dt * (player.speed/CFG.maxS + 0.3));
    if(keys['ArrowRight'] || keys['KeyD']) player.x = Math.min(0.85, player.x + 1.5 * dt * (player.speed/CFG.maxS + 0.3));

    player.speed = Math.max(0, Math.min(player.speed, CFG.maxS));
    player.z += player.speed * dt;

    if(player.z >= trackLength) {
        player.z -= trackLength;
        player.lap++;
        if(player.lap > 3) finish();
    }

    cars.forEach(c => {
        c.z += c.speed * dt;
        if(c.z >= trackLength) c.z -= trackLength;
    });

    let rank = 1;
    cars.forEach(c => { if(c.z > player.z) rank++; });
    document.getElementById('pos-ui').innerText = `SIRA: ${rank}/8`;
    document.getElementById('speed-ui').innerText = Math.round(player.speed/100);
}

// GELÄ°ÅžMÄ°Åž ARABA Ã‡Ä°ZÄ°M MOTORU (VEKTÃ–REL)
function drawVehicle(ctx, x, y, width, color, isPlayer = false) {
    let w = width;
    let h = w * 0.5;

    ctx.save();
    ctx.translate(x, y);

    // GÃ¶lge
    ctx.fillStyle = "rgba(0,0,0,0.3)";
    ctx.beginPath(); ctx.ellipse(0, h/2, w*0.6, h*0.3, 0, 0, Math.PI*2); ctx.fill();

    // GÃ¶vde (Alt Katman)
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.roundRect(-w/2, -h/2, w, h, w*0.1);
    ctx.fill();

    // Ãœst Kabin
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.beginPath();
    ctx.roundRect(-w/3, -h/1.2, w/1.5, h/1.5, w*0.1);
    ctx.fill();

    // Cam DetayÄ±
    ctx.fillStyle = "rgba(255,255,255,0.2)";
    ctx.beginPath();
    ctx.moveTo(-w/4, -h/1.3); ctx.lineTo(w/4, -h/1.3); ctx.lineTo(w/3.5, -h/2); ctx.lineTo(-w/3.5, -h/2);
    ctx.fill();

    // Arka RÃ¼zgarlÄ±k (Spoiler)
    ctx.fillStyle = "#111";
    ctx.fillRect(-w/2, -h/1.4, w, h/8);

    // Stop LambalarÄ±
    ctx.fillStyle = isPlayer && keys['ArrowDown'] ? "#ff0000" : "#880000";
    ctx.fillRect(-w/2.2, -h/3, w/6, h/5);
    ctx.fillRect(w/3.5, -h/3, w/6, h/5);

    ctx.restore();
}

function render() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    
    // GÃ¶kyÃ¼zÃ¼ ve Ã‡imen
    ctx.fillStyle = "#72d7ee"; ctx.fillRect(0,0, canvas.width, canvas.height/2);
    ctx.fillStyle = "#39a032"; ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height/2);

    let base = Math.floor(player.z / CFG.segL);
    let x=0, dx=0;

    for(let n=0; n<CFG.drawD; n++) {
        let s = segments[(base + n)%segments.length];
        let loop = s.index < base;

        project(s.p1, player.x*CFG.roadW - x, CFG.camH, player.z - (loop?trackLength:0));
        project(s.p2, player.x*CFG.roadW - x - dx, CFG.camH, player.z - (loop?trackLength:0));
        
        x += dx; dx += s.curve;
        if(s.p1.camera.z <= 0) continue;

        // Yol
        ctx.fillStyle = s.color;
        ctx.beginPath();
        ctx.moveTo(s.p1.screen.x - s.p1.screen.w, s.p1.screen.y);
        ctx.lineTo(s.p1.screen.x + s.p1.screen.w, s.p1.screen.y);
        ctx.lineTo(s.p2.screen.x + s.p2.screen.w, s.p2.screen.y);
        ctx.lineTo(s.p2.screen.x - s.p2.screen.w, s.p2.screen.y);
        ctx.fill();

        // Yan Åžeritler
        ctx.fillStyle = "#fff";
        ctx.fillRect(s.p1.screen.x - s.p1.screen.w - 10, s.p1.screen.y, 20, 2);
        ctx.fillRect(s.p1.screen.x + s.p1.screen.w - 10, s.p1.screen.y, 20, 2);

        // BitiÅŸ Ã‡izgisi
        if(s.index < 15) {
            ctx.fillStyle = s.index % 2 ? "#eee" : "#333";
            ctx.fillRect(s.p1.screen.x - s.p1.screen.w, s.p1.screen.y, s.p1.screen.w*2, 20);
        }
    }

    // Rakip AraÃ§larÄ± Ã‡iz
    cars.forEach(c => {
        let relZ = c.z - player.z;
        if(relZ < 0) relZ += trackLength;
        if(relZ < 30000) {
            let scale = CFG.camD / relZ;
            let cx = (canvas.width/2) + (scale * (c.x - player.x) * CFG.roadW * canvas.width/2);
            let cy = (canvas.height/2) - (scale * -CFG.camH * canvas.height/2);
            drawVehicle(ctx, cx, cy, scale * 300000, c.color);
        }
    });

    // Oyuncu AracÄ± (Sabit konum, dinamik Ã§izim)
    drawVehicle(ctx, canvas.width/2, canvas.height - 150, 250, "#0071e3", true);
}

function finish() {
    running = false;
    let rank = 1;
    cars.forEach(c => { if(c.z > player.z) rank++; });
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('rank-text').innerText = rank + ". OLDUN!";
    document.getElementById('medal-icon').innerText = rank == 1 ? "ðŸ¥‡" : rank <= 3 ? "ðŸ¥ˆ" : "ðŸ¥‰";
}
</script>
</body>
</html>
