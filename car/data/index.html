<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Modern Car Driver 3D - Pro Edition</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #87ceeb; overflow: hidden; font-family: 'SF Pro Display', sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: auto; }
        
        /* MODERN UI */
        .overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 100; color: white; transition: 0.5s; }
        .hidden { display: none !important; opacity: 0; }
        
        .menu-card { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.2); text-align: center; width: 400px; }
        .input-group { margin-bottom: 20px; }
        input { background: rgba(255,255,255,0.1); border: 2px solid #0071e3; color: white; padding: 12px; border-radius: 10px; width: 80%; outline: none; font-size: 1rem; }
        
        .mode-selector { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
        .mode-btn { padding: 10px 20px; border: 1px solid #0071e3; border-radius: 20px; color: white; cursor: pointer; background: transparent; transition: 0.3s; }
        .mode-btn.active { background: #0071e3; box-shadow: 0 0 15px #0071e3; }

        .start-btn { background: #32d74b; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.5rem; font-weight: 700; cursor: pointer; width: 100%; }
        
        #hud { position: absolute; top: 0; left: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; color: white; font-size: 1.5rem; pointer-events: none; text-shadow: 2px 2px 4px #000; }
        .medal-icon { font-size: 5rem; margin: 20px; display: block; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="menu" class="overlay">
        <div class="menu-card">
            <h1>MODERN RACER</h1>
            <div class="input-group">
                <input type="text" id="playerName" placeholder="Ä°sminizi YazÄ±n" maxlength="12">
            </div>
            <p>ZORLUK</p>
            <div class="mode-selector">
                <button class="mode-btn" onclick="setMode(0.7, this)">KOLAY</button>
                <button class="mode-btn active" onclick="setMode(1, this)">NORMAL</button>
                <button class="mode-btn" onclick="setMode(1.4, this)">ZOR</button>
            </div>
            <button class="start-btn" onclick="init()">YARIÅžA BAÅžLA</button>
        </div>
    </div>

    <div id="results" class="overlay hidden">
        <div class="menu-card">
            <span id="medal" class="medal-icon">ðŸ¥‡</span>
            <h2 id="final-status">TEBRÄ°KLER!</h2>
            <p id="rank-text" style="font-size: 1.5rem;"></p>
            <button class="start-btn" onclick="location.reload()">TEKRAR DENE</button>
        </div>
    </div>

    <div id="hud" class="hidden">
        <div id="pos-ui">SIRA: 1/8</div>
        <div id="name-ui">EYMEN</div>
        <div id="speed-ui">0 KM/H</div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let player, segments = [], cars = [], running = false;
let difficultyMult = 1;
let lastTime = 0;
let keys = {};

const CFG = {
    roadW: 2000, segL: 200, camH: 1000, camD: 0.84, drawD: 300,
    maxS: 25000, accel: 8000, brake: -10000, decel: -5000
};

window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

function setMode(m, btn) {
    difficultyMult = m;
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function init() {
    const name = document.getElementById('playerName').value || "SÃœRÃœCÃœ";
    document.getElementById('name-ui').innerText = name.toUpperCase();
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');

    canvas.width = window.innerWidth * window.devicePixelRatio;
    canvas.height = window.innerHeight * window.devicePixelRatio;
    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

    player = { x: 0, z: 0, speed: 0, lap: 1 };
    segments = [];

    // PÄ°ST OLUÅžTURMA
    for(let i=0; i<1500; i++) {
        segments.push({
            index: i,
            p1: { world: { z: i*CFG.segL }, screen: {} },
            p2: { world: { z: (i+1)*CFG.segL }, screen: {} },
            curve: i > 200 && i < 400 ? 3 : i > 600 && i < 800 ? -4 : 0,
            color: Math.floor(i/3)%2 ? '#333' : '#383838',
            tree: (i%6==0) ? (Math.random() > 0.5 ? 1.6 : -1.6) : 0
        });
    }

    // RAKÄ°PLER
    cars = [];
    for(let i=0; i<7; i++) {
        cars.push({
            x: (i%2==0 ? 0.6 : -0.6),
            z: (i+1) * 4000,
            speed: (12000 + Math.random()*6000) * difficultyMult,
            color: `hsl(${i*45}, 70%, 50%)`,
            name: "BOT " + (i+1)
        });
    }

    running = true;
    requestAnimationFrame(loop);
}

function project(p, camX, camY, camZ) {
    p.camera = { x: (p.world.x||0) - camX, y: (p.world.y||0) - camY, z: p.world.z - camZ };
    p.screen.scale = CFG.camD / p.camera.z;
    p.screen.x = (window.innerWidth/2) + (p.screen.scale * p.camera.x * window.innerWidth/2);
    p.screen.y = (window.innerHeight/2) - (p.screen.scale * p.camera.y * window.innerHeight/2);
    p.screen.w = (p.screen.scale * CFG.roadW * window.innerWidth/2);
}

function loop(time) {
    if(!running) return;
    let dt = (time - lastTime)/1000;
    lastTime = time;
    update(dt);
    render();
    requestAnimationFrame(loop);
}

function update(dt) {
    const trackL = segments.length * CFG.segL;
    
    // FÄ°ZÄ°K
    if(keys['ArrowUp'] || keys['KeyW']) player.speed += CFG.accel * dt;
    else if(keys['ArrowDown'] || keys['KeyS']) player.speed += CFG.brake * dt;
    else player.speed += CFG.decel * dt;

    // BARÄ°YER VE KONTROL
    if(keys['ArrowLeft'] || keys['KeyA']) player.x = Math.max(-0.8, player.x - 1.4 * dt);
    if(keys['ArrowRight'] || keys['KeyD']) player.x = Math.min(0.8, player.x + 1.4 * dt);

    player.speed = Math.max(0, Math.min(player.speed, CFG.maxS));
    player.z += player.speed * dt;

    if(player.z >= trackL) {
        player.z -= trackL;
        player.lap++;
        if(player.lap > 3) finish();
    }

    cars.forEach(c => {
        c.z += c.speed * dt;
        if(c.z >= trackL) c.z -= trackL;
    });

    // SIRALAMA HESAPLA
    let rank = 1;
    cars.forEach(c => { if(c.z > player.z) rank++; });
    document.getElementById('pos-ui').innerText = `SIRA: ${rank}/8`;
    document.getElementById('speed-ui').innerText = Math.round(player.speed/100) + " KM/H";
}

function render() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    
    // GÃ–KYÃœZÃœ
    let grad = ctx.createLinearGradient(0,0,0, window.innerHeight);
    grad.addColorStop(0, '#1a73e8'); grad.addColorStop(0.5, '#87ceeb');
    ctx.fillStyle = grad; ctx.fillRect(0,0, window.innerWidth, window.innerHeight);

    let base = Math.floor(player.z / CFG.segL);
    let x=0, dx=0;

    for(let n=0; n<CFG.drawD; n++) {
        let s = segments[(base + n)%segments.length];
        let loop = s.index < base;

        project(s.p1, player.x*CFG.roadW - x, CFG.camH, player.z - (loop?segments.length*CFG.segL:0));
        project(s.p2, player.x*CFG.roadW - x - dx, CFG.camH, player.z - (loop?segments.length*CFG.segL:0));
        
        x += dx; dx += s.curve;

        if(s.p1.camera.z <= 0) continue;

        // YOL
        ctx.fillStyle = s.color;
        ctx.beginPath();
        ctx.moveTo(s.p1.screen.x - s.p1.screen.w, s.p1.screen.y);
        ctx.lineTo(s.p1.screen.x + s.p1.screen.w, s.p1.screen.y);
        ctx.lineTo(s.p2.screen.x + s.p2.screen.w, s.p2.screen.y);
        ctx.lineTo(s.p2.screen.x - s.p2.screen.w, s.p2.screen.y);
        ctx.fill();

        // BÄ°TÄ°Åž Ã‡Ä°ZGÄ°SÄ°
        if(s.index < 10) {
            ctx.fillStyle = "white";
            if(s.index % 2 == 0) ctx.fillRect(s.p1.screen.x - s.p1.screen.w, s.p1.screen.y, s.p1.screen.w*2, 20);
        }

        // AÄžAÃ‡LAR (Daha yumuÅŸak yÃ¼kleme iÃ§in opaklÄ±k eklendi)
        if(s.tree) {
            let tx = s.p1.screen.x + (s.tree * s.p1.screen.w);
            ctx.globalAlpha = Math.min(1, n/20); // Mesafe bazlÄ± gÃ¶rÃ¼nÃ¼rlÃ¼k
            ctx.fillStyle = "#4caf50"; ctx.beginPath(); ctx.arc(tx, s.p1.screen.y-40, 30*s.p1.screen.scale*200, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    // RAKÄ°P ARABALAR
    cars.forEach(c => {
        if(c.z > player.z && c.z < player.z + 20000) {
            let relZ = c.z - player.z;
            let scale = CFG.camD / relZ;
            let cx = (window.innerWidth/2) + (scale * (c.x - player.x) * CFG.roadW * window.innerWidth/2);
            let cy = (window.innerHeight/2) - (scale * -CFG.camH * window.innerHeight/2);
            let w = scale * 1200 * window.innerWidth/2;
            ctx.fillStyle = c.color; ctx.fillRect(cx-w/2, cy-w/3, w, w/2); // Basit Araba Formu
        }
    });

    // OYUNCU ARABASI (MODERN)
    drawPlayerCar();
}

function drawPlayerCar() {
    let cp = { x: window.innerWidth/2, y: window.innerHeight - 100 };
    ctx.fillStyle = "#0071e3";
    // GÃ¶vde
    ctx.beginPath(); ctx.roundRect(cp.x - 70, cp.y, 140, 50, 10); ctx.fill();
    // Cam
    ctx.fillStyle = "rgba(255,255,255,0.3)";
    ctx.beginPath(); ctx.moveTo(cp.x - 50, cp.y); ctx.lineTo(cp.x - 30, cp.y-25); ctx.lineTo(cp.x + 30, cp.y-25); ctx.lineTo(cp.x + 50, cp.y); ctx.fill();
    // Stop LambalarÄ±
    ctx.fillStyle = "red"; ctx.fillRect(cp.x - 65, cp.y + 10, 20, 10); ctx.fillRect(cp.x + 45, cp.y + 10, 20, 10);
}

function finish() {
    running = false;
    let rank = 1;
    cars.forEach(c => { if(c.z > player.z) rank++; });
    
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('rank-text').innerText = rank + ". OLDUN!";
    
    let medal = "ðŸ¥‰";
    if(rank == 1) medal = "ðŸ¥‡";
    else if(rank <= 3) medal = "ðŸ¥ˆ";
    document.getElementById('medal').innerText = medal;
}
</script>
</body>
</html>
